<div class="task-view-container">
    <!-- Header with navigation and actions -->
    <div class="header-section">
        <button mat-icon-button (click)="goBack()" class="back-button">
            <mat-icon>arrow_back</mat-icon>
        </button>
        <h1 class="page-title">
            {{ isEditMode() ? 'Edit Task' : 'Task Details' }}
        </h1>
        <div class="header-actions">
            <button *ngIf="isViewMode()" mat-raised-button color="primary" (click)="enableEditMode()"
                [disabled]="isLoading()">
                <mat-icon>edit</mat-icon>
                Edit
            </button>
        </div>
    </div>

    <!-- Loading indicator -->
    @if(isLoading())
    {
    <div class="loading-container">
        <mat-icon class="spinning">refresh</mat-icon>
        <p>Loading...</p>
    </div>
    }

    @if (error()) {

    <div class="error-container">
        <mat-icon color="warn">error</mat-icon>
        <p>{{ error() }}</p>
    </div>
    }

    @if(task() && !isLoading()) {
    <div class="content-container">

        <!-- view mode -->
        @if(isViewMode()) {
        <mat-card class="task-card">
            <mat-card-header>
                <div class="task-header">
                    <div class="task-title-section">
                        <h2>{{ task()!.title }} </h2>
                        <div class="task-meta">
                            <span class="task-id">ID: {{ task().id }} </span>
                            <span class="status-chip"
                                [ngClass]="task()!.isCompleted ? 'status-completed' : 'status-pending'">
                                {{ task()!.isCompleted ? 'Completed' : 'Pending' }}
                            </span>
                        </div>
                    </div>
                </div>
            </mat-card-header>

            <mat-card-content>
                <div class="field-group">
                    <div class="field">
                        <label>Description:</label>
                        <p class="field-value">{{ task()!.description || 'No description provided' }}</p>
                    </div>

                    <div class="field">
                        <label>Due Date:</label>
                        <p class="field-value due-date">{{ formatDate(task()!.dueDate) }}</p>
                    </div>

                    <div class="field">
                        <label>Created By:</label>
                        <p class="field-value">{{ task()!.createdById }}</p>
                    </div>

                    <div class="field">
                        <label>Assigned To:</label>
                        <p class="field-value">{{ task()!.assignedToId }}</p>
                    </div>
                </div>
            </mat-card-content>
        </mat-card>
        }
        <!-- edit mode -->
        @if (isEditMode()) {
        <mat-card class="task-card edit-mode">
            <mat-card-header>
                <div class="task-header">
                    <h2>Edit Task</h2>
                </div>
            </mat-card-header>

            <mat-card-content>
                <form [formGroup]="taskForm" class="task-form">
                    <!-- Title field -->
                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Title</mat-label>
                        <input matInput formControlName="title" placeholder="Enter task title">
                        @if (taskForm.get('title')?.touched && taskForm.get('title')?.invalid) {
                        <mat-error>
                            {{ getErrorMessage('title') }}
                        </mat-error>
                        }
                    </mat-form-field>

                    <!-- Description field -->
                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Description</mat-label>
                        <textarea matInput formControlName="description" placeholder="Enter task description"
                            rows="4"></textarea>
                    </mat-form-field>

                    <!-- Due Date field -->
                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Due Date</mat-label>
                        <input matInput [matDatepicker]="picker" formControlName="dueDate">
                        <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                        <mat-datepicker #picker></mat-datepicker>
                        @if (taskForm.get('dueDate')?.touched && taskForm.get('dueDate')?.invalid) {
                        <mat-error>
                            {{ getErrorMessage('dueDate') }}
                        </mat-error>
                        }
                    </mat-form-field>

                    <!-- Assigned To field -->
                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Assigned To</mat-label>
                        <input matInput formControlName="assignedToId" placeholder="Enter user ID">
                    </mat-form-field>

                    <!-- Completion status -->
                    <div class="checkbox-field">
                        <mat-checkbox formControlName="isCompleted">
                            Mark as completed
                        </mat-checkbox>
                    </div>
                </form>
            </mat-card-content>

            <mat-card-actions class="card-actions">
                <button mat-raised-button color="primary" (click)="saveChanges()"
                    [disabled]="isLoading() || taskForm.invalid">
                    <mat-icon>save</mat-icon>
                    Save Changes
                </button>
                <button mat-stroked-button (click)="cancelEdit()" [disabled]="isLoading()">
                    <mat-icon>cancel</mat-icon>
                    Cancel
                </button>
            </mat-card-actions>
        </mat-card>
        }
    </div>
    }
</div>